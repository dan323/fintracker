import{r as h,j as a}from"./vendor_react-Djc1MftW.js";import{f as b,s as j}from"./categories-D8CrvOJ-.js";import{c as x,g as C,u as v}from"./index-DbACWYKZ.js";import{R as g,c as k,d as E,X as F,Y as w,T as f,L as N,e as T,P as $,a as R,C as A}from"./vendor_recharts-BHrHECup.js";import"./vendor_react_dom-_jcUkGts.js";import"./vendor_scheduler-BmyE5rk0.js";import"./vendor_papaparse-MRZiT6g1.js";import"./vendor__msgpack_msgpack-D6VyNCmu.js";import"./vendor_react_router-CAHG2pus.js";import"./vendor_web_vitals-Co-curaW.js";import"./vendor_clsx-B-dksMZM.js";import"./vendor_lodash-BVkvN6pE.js";import"./vendor_react_smooth-BLudc2bI.js";import"./vendor_prop_types-C8mTKnMW.js";import"./vendor_fast_equals-C7I1S-bJ.js";import"./vendor_tiny_invariant-BaFNuDhB.js";import"./vendor_d3_shape-BEeVWgsp.js";import"./vendor_d3_path-CimkQT29.js";import"./vendor_victory_vendor-kkW58D1l.js";import"./vendor_d3_scale-Boo5rDhd.js";import"./vendor_internmap-BkD7Hj8s.js";import"./vendor_d3_array-g_qRI3rN.js";import"./vendor_d3_time_format-9CwFdMGF.js";import"./vendor_d3_time-BXrU3AQC.js";import"./vendor_d3_interpolate-CKrgWNb4.js";import"./vendor_d3_color-9lF95FHy.js";import"./vendor_d3_format-CzD4bSOQ.js";import"./vendor_recharts_scale-Dc1GUyjq.js";import"./vendor_decimal_js_light-ZKFLnszB.js";import"./vendor_eventemitter3-uOVCADGG.js";class y{static calculateTransactionEmission(t,n="EU"){if(t.amount>=0)return 0;const o=b(t.category)||x["miscellaneous-others"],e=this.calculateCategoryEmission(o,Math.abs(t.amount)),c=C(o.id,n);return e*c}static calculateCategoryEmission(t,n){if(t.emissionFactor!==void 0)return n*t.emissionFactor;const o=j(t);return o.length===0?0:o.reduce((e,c)=>{const l=c.proportion||1/o.length,m=n*l;return c.emissionFactor!==void 0?e+m*c.emissionFactor:e+this.calculateCategoryEmission(c,m)},0)}static analyzeFootprint(t,n="EU"){const o=new Map;let e=0;t.forEach(s=>{var u;if(s.amount>=0)return;const r=this.calculateTransactionEmission(s);e+=r;const d=((u=b(s.category))==null?void 0:u.name)||"Others";o.set(d,(o.get(d)||0)+r)});const c=Array.from(o.entries()).map(([s,r])=>({category:s,emissions:r,percentage:e>0?r/e*100:0})).sort((s,r)=>r.emissions-s.emissions),l=new Set(t.map(s=>{const r=new Date(s.date);return`${r.getFullYear()}-${r.getMonth()}`})).size,m=l>0?e/l:0,i=this.generateRecommendations(c,e,n);return{totalEmissions:e,monthlyAverage:m,breakdown:c,recommendations:i,region:n}}static generateRecommendations(t,n,o){const e=[];return n===0?["No hay datos suficientes para generar recomendaciones."]:(o==="NO"||o==="FR"?e.push("Tu región tiene una red eléctrica relativamente limpia. Considera la electrificación del transporte y calefacción."):(o==="PL"||o==="DE")&&e.push("Tu región aún depende de combustibles fósiles. Prioriza la eficiencia energética y considera energía solar doméstica."),t.slice(0,3).forEach(({category:l,percentage:m})=>{if(m>20)switch(l.toLowerCase()){case"transport":o==="NO"||o==="FR"?e.push("Con tu red eléctrica limpia, cambiar a un vehículo eléctrico tendría un gran impacto positivo."):e.push("Considera transporte público, caminar, bicicleta, o carpooling para reducir emisiones de transporte.");break;case"transportation":e.push("Considera usar transporte público o vehículos eléctricos para reducir emisiones de transporte.");break;case"food and dining":case"food & dining":case"restaurant":e.push("Reduce el consumo de carne y opta por opciones vegetarianas/veganas más frecuentemente.");break;case"housing and utilities":case"utilities":o==="PL"||o==="CN"?e.push("Tu red eléctrica es intensiva en carbón. Prioriza la eficiencia energética y considera paneles solares."):e.push("Mejora la eficiencia energética de tu hogar y considera cambiar a un proveedor de energía renovable.");break;case"bills & utilities":e.push("Considera cambiar a energía renovable y mejora la eficiencia energética de tu hogar.");break;case"shopping":case"retail":e.push("Compra productos de marcas sostenibles y reduce el consumo de fast fashion.");break;case"travel":e.push("Opta por destinos más cercanos o compensa las emisiones de tus viajes largos.");break;default:e.push(`Revisa tus gastos en ${l} para identificar oportunidades de reducción de emisiones.`)}}),n>1e3?e.push("Tu huella de carbono está por encima del promedio. Considera implementar cambios en las categorías con mayores emisiones."):n>500?e.push("Tu huella de carbono es moderada. Pequeños cambios pueden generar un gran impacto."):e.push("¡Excelente! Tu huella de carbono es relativamente baja. Mantén estos hábitos sostenibles."),e.length>0?e:["Continúa monitoreando tus gastos para identificar oportunidades de reducción de emisiones."])}}const ce=({transactions:p})=>{var m;const{t}=v(),[n,o]=h.useState("timeline"),e=h.useMemo(()=>y.analyzeFootprint(p),[p]),c=h.useMemo(()=>{const i={};return p.forEach(s=>{if(!s.date||!(s.date instanceof Date)||s.amount>=0)return;const r=new Date(s.date),d=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,u=r.toLocaleDateString("es-ES",{month:"short",year:"numeric"}).replace(".","");i[d]||(i[d]={month:u,carbon:0,monthKey:d}),i[d].carbon+=y.calculateTransactionEmission(s)}),Object.values(i).map(s=>({...s,carbon:Number(s.carbon.toFixed(2))})).sort((s,r)=>s.monthKey.localeCompare(r.monthKey))},[p]),l=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#34495e"];return a.jsxs("div",{className:"carbon-footprint-container",children:[a.jsxs("div",{className:"carbon-stats",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("h3",{children:t("carbon.total")}),a.jsxs("p",{children:[e.totalEmissions.toFixed(2)," kg"]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("h3",{children:t("carbon.monthly")}),a.jsxs("p",{children:[e.monthlyAverage.toFixed(2)," kg"]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("h3",{children:t("carbon.topCategory")}),a.jsx("p",{children:((m=e.breakdown[0])==null?void 0:m.category)||"N/A"})]})]}),a.jsxs("div",{className:"view-toggle",children:[a.jsx("button",{className:n==="timeline"?"active":"",onClick:()=>o("timeline"),children:t("carbon.timeline")}),a.jsx("button",{className:n==="breakdown"?"active":"",onClick:()=>o("breakdown"),children:t("carbon.byCategory")})]}),n==="timeline"?a.jsxs("div",{className:"chart-container",children:[a.jsx("h2",{children:t("carbon.monthlyEmissions")}),a.jsx(g,{width:"100%",height:400,children:a.jsxs(k,{data:c,margin:{top:20,right:30,left:20,bottom:20},children:[a.jsx(E,{strokeDasharray:"3 3"}),a.jsx(F,{dataKey:"month",tick:{fontSize:12}}),a.jsx(w,{tickFormatter:i=>`${i} kg`,width:80}),a.jsx(f,{formatter:i=>[`${i.toFixed(2)} kg CO₂e`,t("carbon.total")],labelFormatter:i=>`${t("carbon.label.month")} ${i}`}),a.jsx(N,{}),a.jsx(T,{dataKey:"carbon",type:"monotone",stroke:"#e74c3c",strokeWidth:3,name:t("carbon.total"),dot:{fill:"#e74c3c",strokeWidth:2,r:4},activeDot:{r:6}})]})})]}):a.jsxs("div",{className:"chart-container",children:[a.jsx("h2",{children:t("carbon.byCategoryTitle")}),a.jsx(g,{width:"100%",height:400,children:a.jsxs($,{children:[a.jsx(R,{data:e.breakdown.slice(0,7),dataKey:"emissions",nameKey:"category",cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",label:({category:i,percentage:s})=>`${i}: ${s.toFixed(1)}%`,children:e.breakdown.slice(0,7).map((i,s)=>a.jsx(A,{fill:l[s%l.length]},`cell-${s}`))}),a.jsx(f,{formatter:i=>`${i.toFixed(2)} kg CO₂e`})]})})]}),a.jsxs("div",{className:"recommendations",children:[a.jsx("h3",{children:t("carbon.recommendations")}),a.jsx("ul",{children:e.recommendations.map((i,s)=>a.jsx("li",{children:i},s))})]})]})};export{ce as default};
